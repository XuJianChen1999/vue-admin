import{_ as e,C as a,x as n}from"./index-CMBT9BYn.js";import{r as t,a3 as r,ae as s,af as o,a8 as l,a5 as u,ap as c,aa as f,aD as i,E as p,bN as d,bO as v,aq as g,aE as _,aF as h,a4 as x,aR as m,bL as b,bM as y}from"./.pnpm-DSXWUmMM.js";const D=(e=>(_("data-v-b72fd28d"),e=e(),h(),e))((()=>o("span",null,"拖拽到此处上传",-1))),N=e({__name:"index",props:{beforeUpload:Function,onSuccess:Function},setup(e){const n=e,_=t(null),h=t(!1),x=t({header:null,results:null});function m(e){if(e.stopPropagation(),e.preventDefault(),h.value)return;const n=e.dataTransfer.files;if(1!==n.length)return p.error("只支持上传一个文件");const t=n[0];if(!a(t.name))return p.error("只支持上传 .xlsx, .xls, .csv后缀类型的文件");k(t),e.stopPropagation(),e.preventDefault()}function b(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function y(){_.value.click()}function N(e){const a=e.target.files[0];a&&k(a)}function k(e){_.value=null;const a=n.beforeUpload;if(!a)return void w(e);a(e)&&w(e)}function w(e){return p.success(`文件名是：${e.name}`),h.value=!0,new Promise((a=>{const t=new FileReader;t.onload=e=>{const t=e.target.result,r=d(t,{type:"array"}),s=r.SheetNames[0],o=r.Sheets[s];!function({header:e,results:a}){const t=n.onSuccess;x.value={header:e,results:a},t&&t({header:e,results:a})}({header:function(e){const a=[],n=v.decode_range(e["!ref"]);let t;const r=n.s.r;for(t=n.s.c;t<=n.e.c;++t){const n=e[v.encode_cell({c:t,r:r})];let s="UNKNOWN "+t;n&&n.t&&(s=v.format_cell(n)),a.push(s)}return a}(o),results:v.sheet_to_json(o)}),h.value=!1,a()},t.readAsArrayBuffer(e)}))}return(e,a)=>{const n=g;return r(),s(i,null,[o("input",{ref_key:"inputRef",ref:_,class:"excel-upload-input",type:"file",accept:".xlsx, .xls",onChange:N},null,544),o("div",{class:"drop flex",onDrop:m,onDragover:b,onDragenter:b},[D,l(n,{loading:f(h),type:"primary",onClick:y},{default:u((()=>[c(" 点击上传excel ")])),_:1},8,["loading"])],32)],64)}}},[["__scopeId","data-v-b72fd28d"]]),k={__name:"index",setup(e){const a=t([]),o=t([]);function c(e){return e.size/1024/1024<1||(p.warning("不能上传超过1MB的文件"),!1)}function d({results:e,header:n}){a.value=e,o.value=n}return(e,t)=>{const p=b,v=y,g=n;return r(),x(g,null,{default:u((()=>[l(f(N),{"on-success":d,"before-upload":c}),l(v,{data:f(a),border:"","highlight-current-row":"",style:{"margin-top":"22px"}},{default:u((()=>[(r(!0),s(i,null,m(f(o),(e=>(r(),x(p,{key:e,prop:e,label:e},null,8,["prop","label"])))),128))])),_:1},8,["data"])])),_:1})}}};export{k as default};
