import{_ as e,E as a,x as n}from"./index-CjL9fGc7.js";import{h as r,ac as t,an as s,ao as o,ah as l,ae as u,ay as c,aj as i,aM as f,E as p,az as d,ad as h,aX as x,bQ as g,bR as m}from"./.pnpm-BLGzruUg.js";import{r as v,u as _}from"./xlsx-BW9CG9W1.js";const y=e({__name:"index",props:{beforeUpload:Function,onSuccess:Function},setup(e){const n=e,h=r(null),x=r(!1),g=r({header:null,results:null});function m(e){if(e.stopPropagation(),e.preventDefault(),x.value)return;const n=e.dataTransfer.files;if(1!==n.length)return p.error("只支持上传一个文件");const r=n[0];if(!a(r.name))return p.error("只支持上传 .xlsx, .xls, .csv后缀类型的文件");j(r),e.stopPropagation(),e.preventDefault()}function y(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function b(){h.value.click()}function D(e){const a=e.target.files[0];a&&j(a)}function j(e){h.value=null;const a=n.beforeUpload;if(!a)return void k(e);a(e)&&k(e)}function k(e){return p.success(`文件名是：${e.name}`),x.value=!0,new Promise((a=>{const r=new FileReader;r.onload=e=>{const r=e.target.result,t=v(r,{type:"array"}),s=t.SheetNames[0],o=t.Sheets[s];!function({header:e,results:a}){const r=n.onSuccess;g.value={header:e,results:a},r&&r({header:e,results:a})}({header:function(e){const a=[],n=_.decode_range(e["!ref"]);let r;const t=n.s.r;for(r=n.s.c;r<=n.e.c;++r){const n=e[_.encode_cell({c:r,r:t})];let s="UNKNOWN "+r;n&&n.t&&(s=_.format_cell(n)),a.push(s)}return a}(o),results:_.sheet_to_json(o)}),x.value=!1,a()},r.readAsArrayBuffer(e)}))}return(e,a)=>{const n=d;return t(),s(f,null,[o("input",{ref_key:"inputRef",ref:h,class:"excel-upload-input",type:"file",accept:".xlsx, .xls",onChange:D},null,544),o("div",{class:"drop flex",onDrop:m,onDragover:y,onDragenter:y},[a[1]||(a[1]=o("span",null,"拖拽到此处上传",-1)),l(n,{loading:i(x),type:"primary",onClick:b},{default:u((()=>a[0]||(a[0]=[c(" 点击上传excel ")]))),_:1},8,["loading"])],32)],64)}}},[["__scopeId","data-v-b72fd28d"]]),b={__name:"index",setup(e){const a=r([]),o=r([]);function c(e){return e.size/1024/1024<1||(p.warning("不能上传超过1MB的文件"),!1)}function d({results:e,header:n}){a.value=e,o.value=n}return(e,r)=>{const p=g,v=m,_=n;return t(),h(_,null,{default:u((()=>[l(i(y),{"on-success":d,"before-upload":c}),l(v,{data:i(a),border:"","highlight-current-row":"",style:{"margin-top":"22px"}},{default:u((()=>[(t(!0),s(f,null,x(i(o),(e=>(t(),h(p,{key:e,prop:e,label:e},null,8,["prop","label"])))),128))])),_:1},8,["data"])])),_:1})}}};export{b as default};
