import{B as e,A as t,_ as l,x as a}from"./index-CjL9fGc7.js";import{h as o,ab as u,cc as n,aI as r,bz as d,cd as i,aJ as s,ac as f,an as m,ai as c,ad as p,ae as g,ah as h,aj as v,aO as b,ay as V,aR as y,b3 as _,bL as x,b0 as w,ce as z,a_ as S,bN as U,bO as $,aY as A,az as I,bE as k}from"./.pnpm-BLGzruUg.js";import{C as N}from"./card-form-D6_MvVv7.js";import{_ as j}from"./col-BWviMN8V.js";import"./useForm-_BcR63q1.js";function R(){return window.devicePixelRatio||1}function W(e,t,l,a,o,u,n){const r=u,d=R(),i=r.content,s=r.fontSize,f=r.fontWeight,m=r.fontFamily,c=r.fontStyle,p=r.color,g=Number(s)*d;e.font=`${c} normal ${f} ${g}px/${o}px ${m}`,e.fillStyle=p,e.textAlign="center",e.textBaseline="top",e.translate(a/2,0);const h=Array.isArray(i)?i:[i];null==h||h.forEach(((a,o)=>{e.fillText(a??"",t,l+o*(g+n*d))}))}function E(e,t,l,a){e.translate(t,l),e.rotate(Math.PI/180*Number(a)),e.translate(-t,-l)}const L=[100,100],C={width:Number,height:Number,layout:{type:String,default:"alternate"},rotate:{type:Number,default:-22},zIndex:{type:Number,default:90},image:{type:String,default:void 0},content:{type:String,default:""},fullscreen:{type:Boolean,default:!1},auto:{type:Boolean,default:!0},color:{type:String,default:"rgba(0,0,0,.15)"},fontSize:{type:Number,default:16},fontStyle:{type:String,default:"normal"},fontWeight:{type:String,default:"normal"},fontFamily:{type:String,default:"sans-serif"},gap:{type:Array,default:()=>L},offset:{type:Array,default:()=>[L[0]/2,L[1]/2]}},F={__name:"index",props:C,setup(l,{expose:a}){const p=l,g=i(),h=i(),v=o(!1),b=document.body,V=u((()=>{var e;return(null==(e=p.gap)?void 0:e[0])??100})),y=u((()=>{var e;return(null==(e=p.gap)?void 0:e[1])??100})),_=u((()=>V.value/2)),x=u((()=>y.value/2)),w=u((()=>{var e;return(null==(e=p.offset)?void 0:e[0])??_.value})),z=u((()=>{var e;return(null==(e=p.offset)?void 0:e[1])??x.value})),S=u((()=>({parallel:1,alternate:2}[p.layout]))),U=u((()=>{const t={zIndex:p.zIndex??9,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let l=w.value-_.value,a=z.value-x.value;return l>0&&(t.left=e(l)`${l}`,t.width=`calc(100% - ${e(l)})`,l=0),a>0&&(t.top=e(a),t.height=`calc(100% - ${e(a)})`,a=0),t.backgroundPosition=`${e(l)} ${e(a)}`,t}));function $(){const e=h.value;e&&(e.remove(),h.value=void 0)}function A(t,l){const a=g.value,o=h.value;var u;a&&o&&(v.value=!0,o.setAttribute("style",(u={...U.value,backgroundImage:`url('${t}')`,backgroundSize:e((V.value+l)*S.value)},Object.keys(u).map((e=>`${function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}(e)}: ${u[e]};`)).join(" "))),p.fullscreen?(b.setAttribute("style","position: relative"),b.append(o)):null==a||a.append(o),setTimeout((()=>{v.value=!1})))}function I(){const t=document.createElement("canvas"),l=t.getContext("2d"),a=p,o=a.image,u=a.rotate??-22;if(l){h.value||(h.value=document.createElement("div"));const n=R(),[r,d]=function(t,l,a){let o=120,u=64;const n=l,r=n.content,d=n.width,i=n.height,s=n.fontSize;if(!n.image&&t.measureText){t.font=`${e(Number(s))} ${n.fontFamily}`;const l=Array.isArray(r)?r:[r],d=l.map((e=>t.measureText(e).width));o=Math.ceil(Math.max(...d)),u=Number(s)*l.length+(l.length-1)*a}return[d??o,i??u]}(l,a,3),i=(V.value+r)*n,s=(y.value+d)*n;t.setAttribute("width",e(i*S.value)),t.setAttribute("height",e(s*S.value));const f=V.value*n/2,m=y.value*n/2,c=r*n,p=d*n,g=(c+V.value*n)/2,v=(p+y.value*n)/2,b=f+i,_=m+s,x=g+i,w=v+s;if(l.save(),E(l,g,v,u),o){const e=new Image;e.onload=()=>{l.drawImage(e,f,m,c,p),l.restore(),E(l,x,w,u),l.drawImage(e,b,_,c,p),A(t.toDataURL(),r)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=o}else W(l,f,m,c,p,a,3),l.restore(),E(l,x,w,u),W(l,b,_,c,p,a,3),A(t.toDataURL(),r)}}return r((()=>p),(()=>p.auto&&I()),{deep:!0,flush:"post"}),s((()=>p.auto&&I())),d((()=>$())),function(e,l,a){const i=o(!1);let s;const f=u((()=>{const l=n(e);return l?t(l)?l.map((e=>n(e))).filter((e=>e)):[l]:[]}));function m(){f.value.length&&!i.value&&(s=new ResizeObserver(l),f.value.forEach((e=>s.observe(e,a))))}function c(){s&&(s.disconnect(),s=void 0)}r((()=>f.value),(()=>{c(),m()}),{immediate:!0,flush:"post"}),d((()=>c()))}(p.fullscreen?b:g,(function(e){v.value||e.forEach((e=>{(function(e,t){let l=!1;return e.removedNodes.length&&(l=Array.from(e.removedNodes).some((e=>e===t))),"attributes"===e.type&&e.target===t&&(l=!0),l})(e,h.value)&&($(),I())}))}),{subtree:!0,childList:!0,attributes:!0,attributeFilter:["style","class"]}),a({renderWatermark:I,clear:$}),(e,t)=>(f(),m("div",{ref_key:"containerRef",ref:g,style:{position:"relative"}},[c(e.$slots,"default")],512))}},O=l({__name:"index",setup(e){const t=o(null),l=o({text:"水印内容",fontWeight:"normal",fullscreen:!1,auto:!0,image:null,zIndex:19,rotate:-22,fontSize:16,gap:[70,40],offset:[1,2],width:130,height:30,color:"rgba(0, 0, 0, 0.15)"});function u(){t.value.clear()}function n(){t.value.renderWatermark()}return(e,o)=>{const r=y,d=_,i=x,s=w,m=z,c=S,R=U,W=$,E=A,L=I,C=k,O=a;return f(),p(O,null,{default:g((()=>[h(v(N),{modelValue:v(l),"onUpdate:modelValue":o[15]||(o[15]=e=>b(l)?l.value=e:null),"label-width":"120",class:"card-form"},{content:g((()=>[h(E,{wrap:""},{default:g((()=>[h(L,{onClick:n},{default:g((()=>o[16]||(o[16]=[V("手动创建水印")]))),_:1}),h(L,{type:"warning",onClick:u},{default:g((()=>o[17]||(o[17]=[V("清除水印")]))),_:1})])),_:1})])),default:g((()=>[h(i,{gutter:50},{default:g((()=>[h(v(j),{label:"水印内容"},{default:g((()=>[h(r,{modelValue:v(l).text,"onUpdate:modelValue":o[0]||(o[0]=e=>v(l).text=e)},null,8,["modelValue"])])),_:1}),h(v(j),{label:"宽"},{default:g((()=>[h(d,{modelValue:v(l).width,"onUpdate:modelValue":o[1]||(o[1]=e=>v(l).width=e)},null,8,["modelValue"])])),_:1}),h(v(j),{label:"高"},{default:g((()=>[h(d,{modelValue:v(l).height,"onUpdate:modelValue":o[2]||(o[2]=e=>v(l).height=e)},null,8,["modelValue"])])),_:1})])),_:1}),h(i,{gutter:50},{default:g((()=>[h(v(j),{label:"自动添加"},{default:g((()=>[h(s,{modelValue:v(l).auto,"onUpdate:modelValue":o[3]||(o[3]=e=>v(l).auto=e)},null,8,["modelValue"])])),_:1}),h(v(j),{label:"添加图片"},{default:g((()=>[h(s,{modelValue:v(l).image,"onUpdate:modelValue":o[4]||(o[4]=e=>v(l).image=e),"inactive-value":null,"active-value":"https://element-plus.org/images/element-plus-logo.svg"},null,8,["modelValue"])])),_:1}),h(v(j),{label:"全屏水印"},{default:g((()=>[h(s,{modelValue:v(l).fullscreen,"onUpdate:modelValue":o[5]||(o[5]=e=>v(l).fullscreen=e)},null,8,["modelValue"])])),_:1})])),_:1}),h(i,{gutter:50},{default:g((()=>[h(v(j),{label:"旋转角度"},{default:g((()=>[h(m,{modelValue:v(l).rotate,"onUpdate:modelValue":o[6]||(o[6]=e=>v(l).rotate=e),min:-180,max:180},null,8,["modelValue"])])),_:1}),h(v(j),{label:"字体大小"},{default:g((()=>[h(m,{modelValue:v(l).fontSize,"onUpdate:modelValue":o[7]||(o[7]=e=>v(l).fontSize=e),min:10,max:40},null,8,["modelValue"])])),_:1}),h(v(j),{label:"层级"},{default:g((()=>[h(m,{modelValue:v(l).zIndex,"onUpdate:modelValue":o[8]||(o[8]=e=>v(l).zIndex=e)},null,8,["modelValue"])])),_:1})])),_:1}),h(i,{gutter:50},{default:g((()=>[h(v(j),{label:"水印颜色"},{default:g((()=>[h(c,{modelValue:v(l).color,"onUpdate:modelValue":o[9]||(o[9]=e=>v(l).color=e)},null,8,["modelValue"])])),_:1}),h(v(j),{label:"字体粗细"},{default:g((()=>[h(W,{modelValue:v(l).fontWeight,"onUpdate:modelValue":o[10]||(o[10]=e=>v(l).fontWeight=e)},{default:g((()=>[h(R,{label:"normal",value:"normal"}),h(R,{label:"weight",value:"weight"}),h(R,{label:"light",value:"light"}),h(R,{label:"number",value:"number"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),h(i,{gutter:50},{default:g((()=>[h(v(j),{label:"水印之间的间距"},{default:g((()=>[h(E,null,{default:g((()=>[h(d,{modelValue:v(l).gap[0],"onUpdate:modelValue":o[11]||(o[11]=e=>v(l).gap[0]=e),"controls-position":"right"},null,8,["modelValue"]),h(d,{modelValue:v(l).gap[1],"onUpdate:modelValue":o[12]||(o[12]=e=>v(l).gap[1]=e),"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1}),h(v(j),{label:"偏移量"},{default:g((()=>[h(E,null,{default:g((()=>[h(d,{modelValue:v(l).offset[0],"onUpdate:modelValue":o[13]||(o[13]=e=>v(l).offset[0]=e),placeholder:"offsetLeft","controls-position":"right"},null,8,["modelValue"]),h(d,{modelValue:v(l).offset[1],"onUpdate:modelValue":o[14]||(o[14]=e=>v(l).offset[1]=e),placeholder:"offsetTop","controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(v(F),{ref_key:"watermarkRef",ref:t,content:v(l).text,fullscreen:v(l).fullscreen,auto:v(l).auto,image:v(l).image,"z-index":v(l).zIndex,rotate:v(l).rotate,color:v(l).color,"font-size":v(l).fontSize,"font-weight":v(l).fontWeight,gap:v(l).gap,offset:v(l).offset,width:v(l).width,height:v(l).height},{default:g((()=>[h(C,{shadow:"never",class:"card-box",style:{width:"100%",height:"350px"}})])),_:1},8,["content","fullscreen","auto","image","z-index","rotate","color","font-size","font-weight","gap","offset","width","height"])])),_:1})}}},[["__scopeId","data-v-2015a78f"]]);export{O as default};
