import{_ as e,C as a,x as n}from"./index-D91Jtym3.js";import{r,a3 as t,ae as s,af as o,a8 as l,a5 as u,ap as c,aa as f,aD as i,E as p,bK as d,bL as g,aq as v,a4 as _,aO as h,bI as x,bJ as m}from"./.pnpm-BO0thPis.js";const b=e({__name:"index",props:{beforeUpload:Function,onSuccess:Function},setup(e){const n=e,_=r(null),h=r(!1),x=r({header:null,results:null});function m(e){if(e.stopPropagation(),e.preventDefault(),h.value)return;const n=e.dataTransfer.files;if(1!==n.length)return p.error("只支持上传一个文件");const r=n[0];if(!a(r.name))return p.error("只支持上传 .xlsx, .xls, .csv后缀类型的文件");k(r),e.stopPropagation(),e.preventDefault()}function b(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function y(){_.value.click()}function D(e){const a=e.target.files[0];a&&k(a)}function k(e){_.value=null;const a=n.beforeUpload;if(!a)return void w(e);a(e)&&w(e)}function w(e){return p.success(`文件名是：${e.name}`),h.value=!0,new Promise((a=>{const r=new FileReader;r.onload=e=>{const r=e.target.result,t=d(r,{type:"array"}),s=t.SheetNames[0],o=t.Sheets[s];!function({header:e,results:a}){const r=n.onSuccess;x.value={header:e,results:a},r&&r({header:e,results:a})}({header:function(e){const a=[],n=g.decode_range(e["!ref"]);let r;const t=n.s.r;for(r=n.s.c;r<=n.e.c;++r){const n=e[g.encode_cell({c:r,r:t})];let s="UNKNOWN "+r;n&&n.t&&(s=g.format_cell(n)),a.push(s)}return a}(o),results:g.sheet_to_json(o)}),h.value=!1,a()},r.readAsArrayBuffer(e)}))}return(e,a)=>{const n=v;return t(),s(i,null,[o("input",{ref_key:"inputRef",ref:_,class:"excel-upload-input",type:"file",accept:".xlsx, .xls",onChange:D},null,544),o("div",{class:"drop flex",onDrop:m,onDragover:b,onDragenter:b},[a[1]||(a[1]=o("span",null,"拖拽到此处上传",-1)),l(n,{loading:f(h),type:"primary",onClick:y},{default:u((()=>a[0]||(a[0]=[c(" 点击上传excel ")]))),_:1},8,["loading"])],32)],64)}}},[["__scopeId","data-v-b72fd28d"]]),y={__name:"index",setup(e){const a=r([]),o=r([]);function c(e){return e.size/1024/1024<1||(p.warning("不能上传超过1MB的文件"),!1)}function d({results:e,header:n}){a.value=e,o.value=n}return(e,r)=>{const p=x,g=m,v=n;return t(),_(v,null,{default:u((()=>[l(f(b),{"on-success":d,"before-upload":c}),l(g,{data:f(a),border:"","highlight-current-row":"",style:{"margin-top":"22px"}},{default:u((()=>[(t(!0),s(i,null,h(f(o),(e=>(t(),_(p,{key:e,prop:e,label:e},null,8,["prop","label"])))),128))])),_:1},8,["data"])])),_:1})}}};export{y as default};
